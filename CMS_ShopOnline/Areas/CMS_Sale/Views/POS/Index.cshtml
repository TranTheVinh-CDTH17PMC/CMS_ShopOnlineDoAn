@using CMS_ShopOnline.Areas.CMS_Sale.Models
@using CMS_ShopOnline.Helpers;
@model POSViewModel
@{
}

<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<base href="">
<link rel="shortcut icon" type="image/png" href="/Assets/public/templates/images/pos.png">
<title>POS MyCoffee</title>
<link href="/Assets/public/templates/css/bootstrap.min.css" rel="stylesheet">
<link href="/Assets/public/templates/css/font-awesome.min.css" rel="stylesheet">
<link href="/Assets/public/templates/css/style.css" rel="stylesheet">
<link href="/Assets/public/templates/css/jquery-ui.min.css" rel="stylesheet">
<link href="/Assets/css/pos.css" rel="stylesheet" type="text/css" />
<link href="/Assets/css/posjsproduct.css" rel="stylesheet" type="text/css" />
<link href="~/Assets/css/PrintPos.css" rel="stylesheet" type="text/css"/>

<style>
    .my-custom-scrollbar {
        position: relative;
        height: 200px;
        overflow: auto;
    }

    .table-wrapper-scroll-y {
        display: block;
    }
    table {
        border-collapse: collapse;
        border-spacing: 0;
        width: 100%;
        border: 1px solid #ddd;
    }

    th, td {
        text-align: left;
        padding: 8px;
    }

    tr:nth-child(even) {
        background-color: #f2f2f2;
    }
    /* Content */
    .content {
        background-color: white;
        padding: 10px;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        transition: 0.3s;
        transition: transform 0.3s;
    }

    .content:hover {
        background-color: #337ab7;
        color:white;
        box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
        transform: scale(1.05);
    }
    .ui-autocomplete-row
        {
        padding:8px;
        background-color: #f4f4f4;
        border-bottom:1px solid #ccc;
        font-weight:bold;
        }
        .ui-autocomplete-row:hover
        {
        background-color: #ddd;
        }
        .detail_item_qty{
            max-width:80px
        }
    /*end content product*/
    /*swal alert*/
        .swal-button {
        padding: 7px 19px;
        border-radius: 2px;
        background-color: #4962B3;
        font-size: 12px;
        border: 1px solid #3e549a;
        text-shadow: 0px -1px 0px rgba(0, 0, 0, 0.3);
    }
    .swal-text {
        background-color: #FEFAE3;
        padding: 17px;
        border: 1px solid #F0E1A1;
        display: block;
        margin: 22px;
        text-align: center;
        color: #61534e;
    }
    /*end*/
    .custom-checkbox {
        min-height: 1rem;
        padding-left: 0;
        margin-right: 0;
        cursor: pointer;
    }

        .custom-checkbox .custom-control-indicator {
            content: "";
            display: inline-block;
            position: relative;
            width: 30px;
            height: 10px;
            background-color: #818181;
            border-radius: 15px;
            margin-right: 10px;
            -webkit-transition: background .3s ease;
            transition: background .3s ease;
            vertical-align: middle;
            margin: 0 16px;
            box-shadow: none;
        }

            .custom-checkbox .custom-control-indicator:after {
                content: "";
                position: absolute;
                display: inline-block;
                width: 18px;
                height: 18px;
                background-color: white;
                border-radius: 21px;
                box-shadow: 0 1px 3px 1px rgba(0, 0, 0, 0.4);
                left: -2px;
                top: -4px;
                -webkit-transition: left .3s ease, background .3s ease, box-shadow .1s ease;
                transition: left .3s ease, background .3s ease, box-shadow .1s ease;
            }

        .custom-checkbox .custom-control-input:checked ~ .custom-control-indicator {
            background-color: #ddd;
            background-image: none;
            box-shadow: none !important;
        }

            .custom-checkbox .custom-control-input:checked ~ .custom-control-indicator:after {
                background-color: #ddd;
                left: 15px;
            }

        .custom-checkbox .custom-control-input:focus ~ .custom-control-indicator {
            box-shadow: none !important;
        }
</style>
</head>
@using (Html.BeginForm(FormMethod.Post))
{
<body style="">
<div class="zopim" __jx__id="___$_73 ___$_73" data-test-id="ChatWidgetButton" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; padding: 0px; border: 0px; background: transparent; overflow: hidden; position: fixed; z-index: 16000002; width: 192px; height: 30px; bottom: 0px; left: 10px;"><iframe frameborder="0" style="background-color: transparent; vertical-align: text-bottom; position: relative; width: 100%; height: 100%; min-width: 100%; min-height: 100%; max-width: 100%; max-height: 100%; margin: 0px; overflow: hidden; display: block;" src="about:blank" data-test-id="ChatWidgetButton-iframe" title="Zendesk Chat widget button" __idm_frm__="96"></iframe></div><div class="zopim" __jx__id="___$_4 ___$_4" data-test-id="ChatWidgetWindow" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; padding: 0px; border: 0px; background: transparent; overflow: hidden; position: fixed; z-index: 16000001; bottom: 0px; left: 10px; border-top-left-radius: 5px; border-top-right-radius: 5px; display: none; width: 290px; height: 400px; box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 3px 2px;"><iframe frameborder="0" style="background-color: transparent; vertical-align: text-bottom; position: relative; width: 100%; height: 100%; min-width: 100%; min-height: 100%; max-width: 100%; max-height: 100%; margin: 0px; overflow: hidden; display: block;" src="about:blank" data-test-id="ChatWidgetWindow-iframe" title="Zendesk Chat widget window" __idm_frm__="94"></iframe></div>
<header>
    <nav id="navbar-container" class="navbar navbar- navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle menu-toggler pull-left" onclick="$('#sidebar').toggleClass('hidden-xs hidden-sm hidden-md')">
                    <span class="sr-only">Toggle sidebar</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <label style="margin: 13px 15px; color: white">
                            Nhân viên : @Helper.CurrentUser.TenNV
                        </label>
                    </li>
                    <li style="border-right: 1px solid #E1E1E1; padding-right: 15px;">
                        <label style="margin: 13px 15px; color: white">
                            @*@Helper.CurrentUser.TenNV*@
                        </label>
                    </li>
                    <li class="dropdown user-profile">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="hello">Xin chào, </span>My Coffee<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="account"><i class="fa fa-user"></i>Tài khoản</a></li>
                            <li><a href="authentication/logout"><i class="fa fa-power-off"></i>Thoát</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>
<section id="pos" class="main" role="main">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12 padd-left-0">
                <div class="main-content">
                    <div class="alert alert-dange ajax-error" role="alert">
                        <span style="font-weight: bold; font-size: 18px;">Thông báo!</span><br>

                        <div class="ajax-error-ct"></div>
                    </div>
                    <div class="alert ajax-success" role="alert" style="width: 350px;background: rgba(92,130,79,0.9); display:none; color: #fff;" data-original-title="" title="">
                        <span style="font-weight: bold; font-size: 18px;">Thông báo!</span>
                        <br>

                        <div class="ajax-success-ct"></div>
                    </div>
                    <div class="modal fade" id="create-cust" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="End();"><span aria-hidden="true">×</span></button>
                                </div>
                                <div class="modal-body">
                                    <video id="preview"></video>
                                </div>
                            </div>
                        </div>
                        <style>
                            video {
                                width: 550px;
                                height: 200px;
                            }
                        </style>
                               
                    </div>
                       
                    <!-- end customer -->
                    <!-- PRODUCTS -->
                    <div>
                        <div class="row">
                            <div class="orders-act">
                                <div class="col-md-7">
                                    <input type="text" placeholder="Tìm kiếm sản phẩm..." id="txtName" class="form-control marg-bot-10" style="width:68.5%">
                                    <div class="main">
                                            <div id="myBtnContainer">
                                            <button class="btnproduct active" onclick="GetProducts(0)"  type="button">Tất cả sản phẩm</button>
                                                @foreach (var item in ViewBag.ListType)
                                                {
                                                    <button class="btnproduct" onclick="GetProducts(@item.Id);" type="button">@item.Ten</button>
                                                }
                                            </div>
                                            
                                        <!-- Portfolio Gallery Grid -->
                                        <div class="rowproduct" id="rowproduct">
                                        </div>
                                        <!-- Load sp js -->
                                        </div>
                                    </div>
                                <div class="col-md-5">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="morder-info" style="padding: 4px;">
                                                <div class="tab-contents" style="padding: 8px 6px;">
                                                    <div class="form-group marg-bot-10 clearfix">
                                                        <div style="padding:0px" class="col-md-4">
                                                            <label>Khách hàng</label>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <div class="col-md-10 padd-0" style="position: relative;">
                                                                <input class="form-control" name="TenKH" value="" id="dlcustomer" placeholder = "Tìm khách hàng (F4)", style="border-radius: 3px 0 0 3px !important;">
                                                                    @if (Helper.Khuyenmai() != true)
                                                                    {
                                                                        <label class="custom-control-label">
                                                                            Sử dụng điểm
                                                                        </label><br />
                                                                        <label class="custom-control custom-checkbox" for="chkPassport">
                                                                            <input class="custom-control-input" data-val="true" data-val-required="The IsDelete field is required." id="chkPassport" name="IsDelete" type="checkbox">
                                                                            <span class="custom-control-indicator"></span>
                                                                        </label>
                                                                        <br />
                                                                        <div id="dvPassport">
                                                                            <label class="custom-control-label">
                                                                                Điểm tích lũy
                                                                            </label>
                                                                            <input class="form-control" value="0" id="diemtoida" placeholder="Điểm tích lũy" , style="border-radius: 3px 0 0 3px !important;" type="number">
                                                                        </div>
                                                                        <input class="form-control" value="" id="tiendoi" type="hidden">
                                                                        <input class="form-control" value="" id="diemdoi" type="hidden">
                                                                        <input class="form-control" value="false" id="checkkhuyenmai" type="hidden">
                                                                    }
                                                                    else
                                                                    {
                                                                        <input class="form-control" value="true" id="checkkhuyenmai" type="hidden">
                                                                    }                                                                        
                                                                @Html.TextBoxFor(x => x.IdKhachHang, new { type="hidden",@Value = "", @class = "form-control", placeholder = "Tìm khách hàng (F4)", style ="border-radius: 3px 0 0 3px !important;"})
                                                                <span style="color: red; position: absolute; right: 5px; top:5px; " class="del-cys"></span>
                                                            </div>
                                                            <div class="col-md-2 padd-0">
                                                                <button type="button" data-toggle="modal" onclick="Click();" data-target="#create-cust" class="btn btn-primary" style="border-radius: 0 3px 3px 0; box-shadow: none; padding: 7px 11px;">
                                                                    <i class="fa fa-camera" style="font-size:20px"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group marg-bot-10 clearfix">
                                                        <div style="padding:0px" class="col-md-4">
                                                            <label>Ghi chú</label>
                                                        </div>
                                                        <div class="col-md-8">
                                                            @Html.TextAreaFor(x => x.GhiChu, new { @class = "form-control", rows = "2", style = "border-radius: 0;" })
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-12">
                                            <div class="table-wrapper-scroll-y my-custom-scrollbar">
                                                <div style="overflow-x:auto;" id="listOrderDetail">
                                                    <div class="table-responsive">
                                                        <table id="myTable" class="table order-list table-bordered table-striped mb-0">
                                                            <thead class="thead-light" style="background-color:#e7cff7">
                                                                <tr>
                                                                    <th scope="col">STT</th>
                                                                    <th scope="col">Tên SP</th>
                                                                    <th scope="col">Số lượng</th>
                                                                    <th scope="col">Đơn giá</th>
                                                                    <th scope="col">Thành tiền</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody class="detailList">
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr size="2">
                                        </div>
                                        <div class="col-md-12">
                                            <h4 class="lighter" style="margin-top: 0;">
                                                <i class="fa fa-info-circle blue"></i>
                                                Thông tin thanh toán
                                            </h4>

                                            <div class="morder-info" style="padding: 4px;">
                                                <div class="tab-contents" style="padding: 8px 6px;">
                                                    <div class="form-group marg-bot-10 clearfix">
                                                        <div class="col-md-4">
                                                            <label>Giảm giá (F7)</label>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <input type="text" id="khuyenmai" class="form-control text-right money1" placeholder="0" style="border-radius: 0 !important;" onchange="change(this, 'TongKM');">
                                                            @Html.TextBoxFor(x => x.TongKM, new { type="hidden" })
                                                        </div>   
                                                    </div>
                                                    <div class="form-group marg-bot-10 clearfix">
                                                        <div class="col-md-4 padd-right-0">
                                                            <label>Khách đưa (F8)</label>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <input type="text" id="Custommer" class="form-control text-right money1" placeholder="0" style="border-radius: 0 !important;">
                                                        </div>  
                                                    </div>
                                                    <div class="form-group marg-bot-10 clearfix">
                                                        <div class="col-md-4">
                                                            <label>Tổng tiền</label>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <input type="text" class="form-control text-right money1" id="totalafterdiscount" placeholder="0"  style="border-radius: 0 !important;" onchange="change(this,'TongTien');" readonly />
                                                            @Html.TextBoxFor(x => x.TongTien, new { @class = "form-control text-right", Type= "hidden" })
                                                        </div>
                                                    </div>
                                                    <div class="form-group marg-bot-10 clearfix">
                                                        <div class="col-md-4">
                                                            <label class="debt">Tiền thừa</label>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <input type="text" class="form-control text-right Excesscash money1" placeholder="0" style="border-radius: 0 !important;" readonly>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-12">
                                            <div class="btn-groups pull-right" style="margin-bottom: 50px;">
                                                <button type="submit" class="btn btn-primary" id="Save">
                                                    <i class="fa fa-check"></i> Lưu (F9)
                                                </button>
                                                <button type="button" class="btn btn-primary">
                                                    <i class="fa fa-print"></i> Lưu và
                                                    in (F10)
                                                </button>
                                                <a href="/orders">
                                                    <button type="button" class="btn-back btn btn-default">
                                                        <i class="fa fa-arrow-left"></i> Hủy
                                                    </button>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script src="/Assets/public/templates/js/jquery.js"></script>
<script src="/Assets/public/templates/js/jquery-ui.min.js"></script>
<script src="/Assets/public/templates/js/html5shiv.min.js"></script>
<script src="/Assets/public/templates/js/respond.min.js"></script>
<script src="/Assets/public/templates/js/bootstrap.min.js"></script>
<script src="/Assets/public/templates/js/ajax.js"></script>
<script type="text/javascript" src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
<script src="~/scripts/jquery.signalR-2.4.1.min.js"></script>
<script src="~/signalr/hubs"></script>
<script src="/Assets/js/posjs.js"></script>
<script src="~/Assets/js/PosJsV2.js"></script>
<script src = "https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script> 
<script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
<script src="~/Assets/js/simple.money.format.js"></script>
<script src="~/Assets/js/number-divider.js"></script>
    @*<ul id="ui-id-1" tabindex="0" class="ui-menu ui-widget ui-widget-content ui-autocomplete ui-front" style="display: none;"></ul><div role="status" aria-live="assertive" aria-relevant="additions" class="ui-helper-hidden-accessible"></div>*@
</body>
}
</html>
@if (ViewBag.SuccessMessage != null)
{
<script>
    $(document).ready(function () {
        newwindow = window.open('/CMS_Sale/POS/Print?id=' + @ViewBag.SuccessMessage + '', 'print', 'height=500,width=500');
        setTimeout(function () {
        }, 500);
    });
</script>
}
<script type="text/javascript">
function change(idthis, idthat) {
    debugger
    var el = idthis.value.replace(/[.]/g, '');
    $("#" + idthat + "").val(el);
}
$('.money1').divide({
    delimiter: ".",
    divideThousand: true
});
$('.money').simpleMoneyFormat();
$("#chkPassport").click(function () {
        if ($(this).is(":checked")) {
            $("#dvPassport").show("slow");
            $("#AddPassport").hide("slow");
            if ($("#dlcustomer").val() != null && $("#dlcustomer").val() != "") {
                Tinhdiemgiamgia();
                calcTotalAmount();
            }
            else
            {
                $("#khuyenmai").val("0");
                calcTotalAmount();
            }
            
        } else {
            $("#dvPassport").hide("slow");
            $("#AddPassport").show("slow");
            $("#khuyenmai").val("0");
            calcTotalAmount();
        }           
});
$("#Print").click(function () {
       
});
$("#Save").click(function () {
    debugger
    var dlcustomer = $("#dlcustomer").val();
    var detailList = $('.detailList').find('tr').length;
    if (detailList == 0) {
        swal({
            text: "Chưa chọn sản phẩm!",
            icon: "warning",
            button: "Đồng ý",
        });
        return false;
    }
    //if (dlcustomer == "") {
    //    swal({
    //        text: "Chưa nhập tên khách hàng!",
    //        icon: "warning",
    //        button: "Đồng ý",
    //    });
    //    return false;
    //}
        
});
</script>

